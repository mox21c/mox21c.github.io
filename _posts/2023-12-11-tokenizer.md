---
layout: article
article_header:
  type: cover
  image:
    src: /assets/images/ai/nlp.png
title: 토큰화(Tokenizer)
sidebar:
  nav: docs-ko
aside:
  toc: true
key: 20231211
tags: tokenizer
lang: ko
---

# Tokenizer
`토큰화`{:.success} `Keras preprocessing`{:.info}

하나의 문서 또는 문장의 내용 의미 파악을 어떻게 하는 것일까?
{: .fs-6 .fw-300 }

ChatGPT 로 인하여 생성형 AI 가 큰 화두로 떠올랐다. 처음 ChatGPT라는게 나왔다는 소리를 듣고.. What? 이라는 물음표를 가지고 있었고, 또한 여기에 신경쓸 겨를도 없이 바쁜 업무를 하고 있었다(당시 나는 생각지도 못한 프로젝트에 투입되었다.)
이렇게 바쁜 시간을 보내고 있었고, 어느날 학교 동기(타 회사 데이터사이언티스트 조직을 이끌고 있는..)와 저녁을 함께 하는 자리에서 다시 ChatGPT에 대한 간단한 얘기를 하게 되었다.

저녁을 함께한 동기의 회사는 ChatGPT에 우호적이였고 자유롭게 ChatGPT 를 사용할 수 있게 하는 사내 문화를 가지고 있었다.
동기는 개발할 때 ChatGPT에 물어보면 코드를 다 짜준다는.. 이런 말도 안되는 이야기를 하는 것이 였다.
물론. 난 부정적이였다. 그 이유는 단 하나! 회사내에서 업무적으로 사용할 수 없다!(보안적으로 취약하다는게 내 결론이였다...... 나의 설자리를 잃어 버릴까봐 부정적으로 생각했을 수도...)

난 집으로 돌아가면서 당장 ChatGPT 를 사용하기 위해 openai 사이트에 가입을 했고, 이것도 부족하여 Notion 유료결재를 하여 ChatGPT를 사용해보았다.(지금도 사용중.....^^)
Notion에서 질문을 던지 후 답변을 받는 순간... 헉!.. 질문에 대한 답변이 너무 깔끔하다.! 그리고.. 이전에 만든 기술블로그를 폐쇄를 해버렸다.

대단한 ChatGPT! 그래도 난 회사 업무로는 사용할 수 없다고 생각하고 그 이유인 언어를 학습하기 위해 문장을 처리하는 방식(keras preprocessing)에 때문이라고 생각한다.
그리고 해당 부분에 대하여 간단히 기술하려 한다.

## 문장 그리고 단어(Tokenizer 처리 1단계)
"철수가 학교에 간다" 이 문장이 무슨 뜻인지 컴퓨터는 어떻게 알까? 결론부터 말하자면 해당 문장을 수치화를 하는 것이다.
수치화 하는 방법은 여러가지가 있고, 이 블로그에 계속해서 정리를 하려한다.
수치화 하기 위해서든 문장을 단어 형태로 분리를 해야한다.

"철수가 학교에 간다"
"영수가 학교에 간다"
"철수가 오락실에 갔다"

위 문장을 어떻게 하면 수치화 할 수 있을까? 아주 쉽게 단어로 분리하여 수치화 하면 된다.
"철수가","영수가","학교에","오락실에","간다","갔다" 라고 단어 형태로 분리를 하고 수치화를 하면된다.

### 원-핫 벡터
단어를 수치화 하는 방법이 여러가지가 있는데 그 중 One-Hot 벡터로 표현할 수 있다.
위 문장을 웟-핫 벡터로는 아래와 같이 표현되는데 위 표현 방법과 약간 다르다.

$$
\begin{bmatrix} 철수가 & 영수가 & 학교에 & 오락실에 & 간다 & 갔다 \\ 1 & 0 & 1 & 0 & 1 & 0 \\ 0 & 1 & 1 & 0 & 1 & 0 \\ 1 & 0 & 0 & 1 & 0 & 1 \end{bmatrix}
$$

즉 10 만개의 단어가 있을 때 해당 단어의 one-hot 벡터로 표현하면 10만개 차원의 행렬로 된다.
즉 엄청난 차원의 **비효율적인 행렬**로 표현이 된다.
원-핫 행렬로 표현 했을 때 또다른 문제점음 **단어간 의미의 파악이 불가능** 하다는 것이다.

## 단어의 순서화(Tokenizer 처리 2단계)
단어를 수치화 할 때 순서를 가질 수 있게 해야한다. 즉 index 를 가지게 해야한다.
- "철수가" : 1
- "영수가" : 2
- "학교에" : 3
- "오락실에" : 4
- "간다" : 5
- "갔다" : 6

그럼 다시 위 문장은 아래와 같이 표현 할 수 있다.
"철수가 학교에 간다" => "1 3 5"
"영수가 학교에 간다" => "2 3 5"
"철수가 오락실에 갔다" => "1 4 6"

단어의 순서를 만들고 순서를 문장에 넣으면 된다. 단어들이 모인게 문장이 되는것이 아니라 단어의 index 값으로 표현함으로써 문장을 표현할 수 있다.

## 문장의 길이 맞춤(Tokenizer 처리 3단계)
위 문장은 3개의 문장을 예시로 들었다.
하지만 우리가 학습하기 위한 문장들은 매우 많고 학습하려는 문장은 여러개의 단어들로 구성되어 있다.

"철수와 영희는 학교에 다녀온 후 오락실로 갔다" 라는 문장이 있다고 가정 해보자.
앞의 문장보다 단어가 늘었다는걸 볼 수 있다.
위 문장을 인덱스 작업을 한다면 이전 문장보다 긴 인덱스가 형성될 것 이다.

컴퓨터는 이러한 부분을 캐치할 수 없다. 즉 우리는 여러 문장을 똑같은 길이로 맞쳐줘야 한다.
짜를 부분이 있으면 짜르면 되는거고 아님 문장의 최대 길이에 맞추는 걸로...

그럼 짧은 문장은 최대 길이를 맞추기 위해 임의의 값을 추가해줘야 한다....이 값은 NLP 에서는 UNK(알 수 없음) 이라고 한다.
이 작업을 tensorflow 에서는 pad_sequences 작업을 하는 것이다.

이글에서 Tensorflow 의 preprocessing 단계를 간단하게 순서대로 기술해 보았다.(사실 중간중간에 엄청난 데이터 분석이 아뤄지고 많은 기술들이 들어간다.)
여러 문장을 가지고 각 단어의 인덱스를 만들고 그 인덱스를 가지고 모형을 만들 때 이용하게 된다.
구글에서 검색해서 나오는 내용들을 회사내에서 사용할 수 있다면 ChatGPT를 이용하여 업무에 적용할 수 있을 것이다.

하지만 회사내에서 쓰는 단어와 문법들은 일반적으로 인터넷상에 떠도는 단어와는 확연한 차이를 보인다. 또한 다른 단어를 사용하기도 한다. 회사 내 보고서를 구글에서 찾을 수 없는 것처럼...

그래서 난 업무에 ChatGPT를 사용하는데 한계는 존재할 꺼라 보고 있고, 생성형 AI를 업무내 적용하기는 힘들다고 생각한다.

하지만 지금 몇몇 대기업에서는 사내 빅데이터를 가지고 LLM 서비스를 진행중에 있는 걸로 알고 있다. 물론 사내 데이터를 이용해 만든 모형은 외부에 공개 하기 힘들다는 점이다.
